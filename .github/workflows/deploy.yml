name: test
on:
  workflow_dispatch:
  pull_request:
    branches:
    - main
    paths:
    - 'syslog'
    
jobs:
  testing:
    runs-on: ubuntu-latest
    environment: production
    permissions:
      id-token: write
      contents: read
    
    steps:
    - name: Git clone repository
      uses: actions/checkout@v3
   
    - name: Install syslog-ng
      run: |
        wget http://ftp.us.debian.org/debian/pool/main/s/syslog-ng/syslog-ng-core_3.28.1-2+b1_amd64.deb
        sudo apt install ./syslog-ng-core_3.28.1-2+b1_amd64.deb
        
    - name: Copy syslog-ng.conf from repo to runner
      run: |
        sudo cp syslog/syslog-ng.conf /etc/syslog-ng/syslog-ng.conf
    
    - name: Check syntax against configs
      run: sudo syslog-ng -s